---
- name: install project packages
  apt: name={{ item }} state=present update_cache=true
  with_items:
    - git
    - python-virtualenv
  register: packages_installed

- name: copy git config
  when: packages_installed|success
  become: yes
  become_user: "{{ project_user }}"
  template: src=gitconfig dest={{ ansible_env.HOME }}/.gitconfig

- name: fetch project repository
  when: packages_installed|success
  git: repo={{ github.address }} dest={{ git.repo_location }}

- name: install project requirements
  when: packages_installed|success
  pip:
    requirements: "{{ pip.requirements_location }}"
    virtualenv: "{{ virtualenv.location }}"
    virtualenv_python: python3
